# Lab2——配置`Web`服务器，编写简单页面，分析交互过程

> **学号：2111033\
> 姓名：艾明旭\
> 专业：信息安全**

## 一、作业说明

1. 搭建`Web`服务器（自由选择系统），并制作简单的`Web`页面，包含简单文本信息（至少包含专业、学号、姓名）和自己的`LOGO`。
2. 通过浏览器获取自己编写的`Web`页面，使用`Wireshark`捕获浏览器与`Web`服务器的交互过程，并进行简单的分析说明。
3. 提交实验报告。

## 二、配置`Web`服务器

### (1)环境配置

本人使用的是`windows`电脑，主机的环境如下：

- 操作系统：`win11`
- 抓包工具：`Wireshark`
- 语言：`html`
- 框架：`node.js`
- 浏览器：`IE`

### (2)运行说明

本次`web`服务器的框架使用的是`node.js`的`http-server`框架

如果想要运行本次项目，首先在控制面板当中下载安装IIS

![](C:\Users\86151\AppData\Roaming\marktext\images\2023-10-26-17-08-02-image.png)

在程序与功能页面当中选择IIS添加后选择确定。

之后我们打开相关的网站，设定相关的信息。

![](C:\Users\86151\AppData\Roaming\marktext\images\2023-10-26-17-12-12-image.png)

![](C:\Users\86151\AppData\Roaming\marktext\images\2023-10-26-17-14-48-image.png)

![](C:\Users\86151\AppData\Roaming\marktext\images\2023-10-26-17-17-12-image.png)

### (3)运行过程

首先是编辑html页面，按照题目要求输入信息。

![](C:\Users\86151\AppData\Roaming\marktext\images\2023-10-26-17-18-46-image.png)

接下来在官网当中下载node.js之后按照所需要的方式安装并启动

之后在终端里下载http-server

```
npm install http-server -g
```

之后输入http-server以启动该程序

![](C:\Users\86151\AppData\Roaming\marktext\images\2023-10-26-17-26-37-image.png)

我们的服务器就能够成功启动，接下来我们就可以启动页面。

开启服务器后，在浏览器中输入提示的网址即可显示页面

![](C:\Users\86151\AppData\Roaming\marktext\images\2023-11-03-19-41-38-image.png)

## 三、交互过程分析

### (1)捕获数据报

首先开启`Wireshark`程序，在浏览器中输入`http://127.0.0.1:8080`到本机开启的`web`服务器，可以看到如下界面：

![](C:\Users\86151\AppData\Roaming\marktext\images\2023-10-26-17-41-36-image.png)

接下来我们选择VMnet8，之后选择编辑捕获过滤器，在Filter Expression里选择输入host 192.168.130.1 and port 8080 ![](C:\Users\86151\AppData\Roaming\marktext\images\2023-10-26-17-44-18-image.png)

在本次的实验中没有去租借服务器，客户端和服务器都是在本机上运行的，所以选择自己的过滤器，并且选择adapter这个选项去进行数据报的嗅探。进去之后可以看到如下界面：

![](C:\Users\86151\AppData\Roaming\marktext\images\2023-10-26-22-03-57-image.png)

![](C:\Users\86151\AppData\Roaming\marktext\images\2023-10-26-22-01-52-image.png)

基于此界面来进行本次关于网络传输数据报的分析。

### (2)`HTTP`数据分析

本次的网页设计采用的是`HTTP`协议进行传输，HTTP协议（Hyper Text Transfer Protocol，超文本传输协议）,是用于从万维网（WWW:World Wide Web ）服务器传输超文本到本地浏览器的传送协议。HTTP基于TCP/IP通信协议来传递数据。HTTP基于客户端/服务端（C/S）架构模型，通过一个可靠的链接来交换信息，是一个无状态的请求/响应协议。

> HTTP的特点：

- HTTP是无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。
- HTTP是媒体独立的：只要客户端和服务器知道如何处理的数据内容，任何类型的数据都可以通过HTTP发送。客户端以及服务器指定使用适合的MIME-type内容类型。
- HTTP是无状态：无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。

首先在过滤器中输入`'http'`进行筛选，可以得到如下的界面：

![](C:\Users\86151\AppData\Roaming\marktext\images\2023-10-26-22-17-35-image.png)

从这张图中可以看出，node框架采用的是http1.1协议来向本机服务器发起一个get请求，然后在服务器收到此get请求后将其所请求的数据返还给客户端，接下来对请求和返还的具体数据报信息进行分析。

> 访问页面的请求

点击第一行的数据报，可以进入到其具体信息的界面，概览信息如下图所示：

![](C:\Users\86151\AppData\Roaming\marktext\images\2023-10-26-22-18-54-image.png)

由理论课上的知识可以得知，`HTTP`请求报文由3部分组成（**请求行**+**请求头**+**请求体**）：

#### **请求行：**

请求行分为三部分：

- 请求方法：GET和POST是最常见的HTTP方法，除此以外还包括DELETE、HEAD、OPTIONS、PUT、TRACE
- 请求对应的URL地址，它和报文头的Host属性组成完整的请求URL
- HTTP协议名称及版本号

他们之间以空格分隔，每一行都以\r\n结尾，可以看出本次是GET请求，以HTTP1.1请求当前页面。

#### **请求头：**

HTTP的报文头包含若干个属性，格式为“属性名:属性值”，服务端据此获取客户端的信息。与缓存相关的规则信息，均包含在header中。

常见的请求头有以下几种：

- Accept：请求报文可通过一个“Accept”报文头属性告诉服务端客户端接受什么类型的响应，Accept属性的值可以为一个或多个MIME类型的值（描述消息内容类型的因特网标准， 消息能包含文本、图像、音频、视频以及其他应用程序专用的数据）
- Referer：表示这个请求是传输过来的URL，如果通过google搜索出一个商家的广告页面，这个请求报文的Referer报文头属性值就是http://www.google.com
- Cookie：客户端的Cookie就是通过这个报文头属性传给服务端
- Cache-Control：对缓存进行控制

本次可看出有Host、connection、Accept等键值对。

#### **请求体：**

报文体将一个页面表单中的组件值通过param1=value1&param2=value2的键值对形式编码成一个格式化串，它承载多个请求参数的数据。

> 服务器返回的数据

点击与GET交互的下一行数据，可以观察到如下两个页面：

![](C:\Users\86151\AppData\Roaming\marktext\images\2023-10-26-22-22-01-image.png)

![](C:\Users\86151\AppData\Roaming\marktext\images\2023-10-26-22-22-32-image.png)

由理论课上的知识可以得知，HTTP的响应报文也由三部分组成（**响应行**+**响应头**+**响应体**）:

#### **响应行：**

响应行由两部分组成：

- 报文协议及版本
- 状态码及状态描述

本次的版本为HTTP1.1并且一切正常。

常见的状态码及其描述：

- 200 (OK): 找到了该资源，并且一切正常。
- 302/307：临时重定向，指出请求的文档已被临时移动到别处, 此文档的新的url在location响应头中给出
- 304 (NOT MODIFIED): 该资源在上次请求之后没有任何修改。这通常用于浏览器的缓存机制。
- 401 (UNAUTHORIZED): 客户端无权访问该资源。这通常会使得浏览器要求用户输入用户名和密码，以登录到服务器。
- 403 (FORBIDDEN): 客户端未能获得授权。这通常是在401之后输入了不正确的用户名或密码。
- 404 (NOT FOUND): 在指定的位置不存在所申请的资源。

#### **响应头：**

响应报文头与请求头类似，也是由多个属性组成。

#### **响应体：**

响应报文体是我们真正想获得的东西，响应体为所请求的数据（可以为html文档内容或图片等各种格式数据），本次即为html文档。

### (3)`TCP`三次握手

TCP的三次握手和四次挥手是建立和终止TCP连接的过程。

1. 三次握手（Three-way Handshake）：
   
   第一步：客户端发送一个SYN（同步）报文给服务器端，表示请求建立连接，并选择一个初始的序列号。
   
   第二步：服务器端接收到SYN报文后，回复一个SYN+ACK（同步+确认）报文给客户端，表示同意建立连接，并为连接分配资源，确认号是客户端的序列号加一。
   
   第三步：客户端收到服务器端的SYN+ACK报文后，向服务器端发送一个ACK（确认）报文，表示连接建立成功。服务器端收到ACK报文后，连接建立完成。
   
   这样，双方完成了三次握手，建立了可靠的TCP连接，可以开始传输数据。

2. 四次挥手（Four-way Handshake）：
   
   第一步：当客户端要关闭连接时，发送一个FIN（结束）报文给服务器端。
   
   第二步：服务器端接收到FIN报文后，返回一个ACK报文作为确认，表示收到客户端的关闭请求。
   
   第三步：服务器端向客户端发送一个FIN报文，表示服务器端也准备关闭连接。
   
   第四步：客户端接收到服务器端的FIN报文后，发送一个ACK报文作为确认，表示双方都同意关闭连接。
   
   这样，双方完成了四次挥手，连接断开。

通过三次握手和四次挥手，TCP实现了可靠的连接建立和连接断开过程，确保数据的可靠传输和资源的及时释放。

TCP协议提供的是按序、可靠的服务，是一种面向连接的传输方式，即其发送数据之前发送方和接收放需要握手，断开链接时需要四次挥手。

> 三次握手过程

1. 第一次握手：客户端发送syn包(seq=x)到服务器，并进入SYN_SEND状态，等待服务器确认

2. 第二次握手：服务器收到syn包，必须确认客户的SYN(ack=x+1)，同时自己也发送一个SYN包(seq=y)，即SYN+ACK包，此时服务器进入SYN_RECV状态

3. 第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=y+1)，此包发送完毕，客户端和服务器进入ESTABLISHED状态，完成三次握手握手过程中传送的包里不包含数据，三次握手完毕后，客户端与服务器才正式开始传送数据。理想状态下，TCP连接一旦建立，在通信双方中的任何一方主动关闭连接之前，TCP连接都将被一直保持下去。
   
   ![](C:\Users\86151\AppData\Roaming\marktext\images\2023-11-03-09-08-00-image.png)

![](C:\Users\86151\AppData\Roaming\marktext\images\2023-10-26-22-43-05-image.png)

- 如上图所示，即为tcp的三次握手过程。首先由64184向8080端口发送了一条syn包，并令seq=x=0（本机初始序列号），报文长度为0，滑动窗口为65535，最大窗口长度为16344，窗口扩大因子为64，此时浏览进入了SYN_SEND状态，这是第一次握手
- 然后服务器8080端口接收到了浏览器发送的syn包后，确认客户的syn，使ack=x+1=1， seq=y=0，对序列号为1 (ack）之前的报文进行确认，同时向客户发送一个（syn,ack）包，其中报文长度为0，滑动窗口为65535，最大窗口长度为16344，这是第二次握手
- 客户端接受到了服务器发送的(syn，ack） 包后，客户端向服务器返回确认包，其中ack=y+1=1，滑动窗口为408256，报文长度为0，这是第三次握手。

至此三次握手完成，服务器和客户端成功建立了联系。

### (4)`TCP`四次挥手

> 四次挥手过程

1. 第一次挥手：Client发送一个FIN，用来关闭Client到Server的数据传送，Client进入FIN_WAIT_1状态。
2. 第二次挥手：Server收到FIN后，发送一个ACK给Client，确认序号为收到序号+1（与SYN相同，一个FIN占用一个序号），Server进入CLOSE_WAIT状态。
3. 第三次挥手：Server发送一个FIN，用来关闭Server到Client的数据传送，Server进入LAST ACK状态。
4. 第四次挥手：Client收到FIN后，Client进入TIME_WAIT状态，接着发送一个ACK给Server，确认序号为收到序号+1，Server进入CLOSED状态，完成四次挥手。

![](C:\Users\86151\AppData\Roaming\marktext\images\2023-10-26-22-23-58-image.png)

![](C:\Users\86151\AppData\Roaming\marktext\images\2023-11-03-16-35-45-image.png)

- 如上图所示，即为tcp四次挥手过程。首先，8080向63897端口发送了一条请求结束的报文(fin，ack)，报文序列号为seq=×=176，ack=y=3394，报文长度为0，这是第一次挥手
- 然后63897端口接收到了浏览器发送的rin包后，确认其报文序列号为seq=y=176,ack=x+1=3393+1=3394，这是第二次挥手
- 然后服务器63897端口再向8080发送—个fin包，其内容与前一个基本相同，用来关闭服务器端到客户端的数据传送，这是第三次挥手
- 8080端口对收到的fin包进行确认，其报文序列号为seq=y=176,ack=3393+1=3394，客户端进入关闭状态，这是第四次挥手。

至此tcp的四次挥手结束，客户端和服务器断开连接，访问结束。

## 四、问题与思考

### (1)问题一

在TCP的四次挥手过程中，有时候会出现RST（重置）报文的情况。RST报文是一种TCP报文，用于立即中止连接，无需经过正常的挥手过程。

![](C:\Users\86151\AppData\Roaming\marktext\images\2023-11-03-17-44-19-image.png)

RST报文的出现可能是由于以下情况：

1. 异常连接终止：当某一方在接收到对方的FIN报文后，发现自己没有对应的连接或者已经关闭了连接，但是对方仍然发送数据。这种情况下，该方可以发送RST报文来中止连接，以表示连接异常终止。

2. 攻击性行为：RST报文也可以被用作网络攻击的一种手段。攻击者可以发送伪造的RST报文，以迫使另一端中止连接，从而中断通信或者进行其他恶意操作。

需要注意的是，正常的四次挥手过程中并不一定会出现RST报文。RST报文的出现通常是在异常情况下才会发生，用于迅速中止连接。

### (2)问题二

本次设计使用的是http协议，但是老师在上课中提到了这个协议并不安全，并且已经有https协议来代替，所以http和https的区别是什么呢？

在查阅网上的相关资料后得知，主要有以下几点区别：

1. HTTPS协议需要到 CA （Certificate Authority，证书颁发机构）申请证书，一般免费证书较少，因而需要一定费用
2. HTTP 是超文本传输协议，信息是明文传输，HTTPS 则是具有安全性的 SSL 加密传输协议
3. HTTP 和 HTTPS 使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443
4. HTTP 的连接很简单，是无状态的。HTTPS 协议是由 SSL+HTTP 协议构建的可进行加密传输、身份认证的网络协议，比 HTTP 协议安全。(无状态的意思是其数据包的发送、传输和接收都是相互独立的。无连接的意思是指通信双方都不长久的维持对方的任何信息。)

所以https可以保证数据传输的机密性和防止重放攻击，是现行架构下最安全的解决方案，虽然不是绝对安全，但它大幅增加了中间人攻击的成本。

但https也有一些缺点，比如握手阶段比较费时、增加数据开销、加密范围也比较有限等，所以使用协议时需要综合考虑。

## 五、总结与展望

### (1)总结

本次实验是计算机网络的第二次实验，这一次的实验主要是对网络数据报进行分析，在本次实验中首先设置了一个简单的web服务器，并对http请求做了分析，接下来对tcp三次握手和四次挥手也做了比较详细的分析，最后也在网上查阅了相关资料，对http和https的区别有了更进一步的认识。

### (2)展望

本次实验让我对网络方面的东西产生了更大的兴趣，由于本学期也选上了`网络技术与应用`这门课，感觉这两门课所用的东西是相辅相成的，希望自己可以结合运用，在本学期得到更好的发展。
